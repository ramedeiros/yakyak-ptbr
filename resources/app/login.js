(function() {
  var Client, Q;

  Client = require('hangupsjs');

  Q = require('q');

  module.exports = function(mainWindow) {
    return Q.Promise(function(rs) {
      var onDidFinishLoad;
      mainWindow.webContents.on('did-finish-load', onDidFinishLoad = function() {
        var code, scr, title, url;
        url = mainWindow.getUrl();
        if (url.indexOf('&response_type=code') > 0) {
          scr = "document.getElementById('connect_approve').submit()";
          mainWindow.webContents.executeJavaScript(scr);
        }
        if (url.indexOf('/o/oauth2/approval') > 0) {
          title = mainWindow.webContents.getTitle();
          code = title.substring(13);
          mainWindow.webContents.removeListener('did-finish-load', onDidFinishLoad);
          return rs(code);
        }
      });
      return mainWindow.loadUrl(Client.OAUTH2_LOGIN_URL);
    });
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvZ2luLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLE1BQUE7O0VBQUEsTUFBQSxHQUFTLE9BQUEsQ0FBUSxXQUFSOztFQUNULENBQUEsR0FBSSxPQUFBLENBQVEsR0FBUjs7RUFHSixNQUFNLENBQUMsT0FBUCxHQUFpQixTQUFDLFVBQUQ7V0FBZ0IsQ0FBQyxDQUFDLE9BQUYsQ0FBVSxTQUFDLEVBQUQ7QUFFdkMsVUFBQTtNQUFBLFVBQVUsQ0FBQyxXQUFXLENBQUMsRUFBdkIsQ0FBMEIsaUJBQTFCLEVBQTZDLGVBQUEsR0FBa0IsU0FBQTtBQUczRCxZQUFBO1FBQUEsR0FBQSxHQUFNLFVBQVUsQ0FBQyxNQUFYLENBQUE7UUFHTixJQUFHLEdBQUcsQ0FBQyxPQUFKLENBQVkscUJBQVosQ0FBQSxHQUFxQyxDQUF4QztVQUNJLEdBQUEsR0FBTTtVQUNOLFVBQVUsQ0FBQyxXQUFXLENBQUMsaUJBQXZCLENBQXlDLEdBQXpDLEVBRko7O1FBS0EsSUFBRyxHQUFHLENBQUMsT0FBSixDQUFZLG9CQUFaLENBQUEsR0FBb0MsQ0FBdkM7VUFFSSxLQUFBLEdBQVEsVUFBVSxDQUFDLFdBQVcsQ0FBQyxRQUF2QixDQUFBO1VBRVIsSUFBQSxHQUFPLEtBQUssQ0FBQyxTQUFOLENBQWdCLEVBQWhCO1VBRVAsVUFBVSxDQUFDLFdBQVcsQ0FBQyxjQUF2QixDQUFzQyxpQkFBdEMsRUFBeUQsZUFBekQ7aUJBRUEsRUFBQSxDQUFHLElBQUgsRUFSSjs7TUFYMkQsQ0FBL0Q7YUFzQkEsVUFBVSxDQUFDLE9BQVgsQ0FBbUIsTUFBTSxDQUFDLGdCQUExQjtJQXhCdUMsQ0FBVjtFQUFoQjtBQUpqQiIsImZpbGUiOiJsb2dpbi5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIkNsaWVudCA9IHJlcXVpcmUgJ2hhbmd1cHNqcydcblEgPSByZXF1aXJlICdxJ1xuXG4jIHByb21pc2UgZm9yIG9uZS10aW1lIG9hdXRoIHRva2VuXG5tb2R1bGUuZXhwb3J0cyA9IChtYWluV2luZG93KSAtPiBRLlByb21pc2UgKHJzKSAtPlxuXG4gICAgbWFpbldpbmRvdy53ZWJDb250ZW50cy5vbiAnZGlkLWZpbmlzaC1sb2FkJywgb25EaWRGaW5pc2hMb2FkID0gLT5cblxuICAgICAgICAjIHRoZSB1cmwgdGhhdCBqdXN0IGZpbmlzaGVkIGxvYWRpbmdcbiAgICAgICAgdXJsID0gbWFpbldpbmRvdy5nZXRVcmwoKVxuXG4gICAgICAgICMgd2hlbiB3ZSBmaW5kIHRoaXMgcGFydCBvZiB0aGUgdXJsLCB3ZSBtdXN0IHByb2dyZXNzIHBhZ2UgdG8gL2FwcHJvdmFsXG4gICAgICAgIGlmIHVybC5pbmRleE9mKCcmcmVzcG9uc2VfdHlwZT1jb2RlJykgPiAwXG4gICAgICAgICAgICBzY3IgPSBcImRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25uZWN0X2FwcHJvdmUnKS5zdWJtaXQoKVwiXG4gICAgICAgICAgICBtYWluV2luZG93LndlYkNvbnRlbnRzLmV4ZWN1dGVKYXZhU2NyaXB0IHNjclxuXG4gICAgICAgICMgdGhpcyBpcyB0aGUgYXBwcm92YWwgcGFnZSBmcm9tIHdoaWNoIHdlIGZpc2ggb3V0IHRoZSBvbmUtdGltZSB0b2tlblxuICAgICAgICBpZiB1cmwuaW5kZXhPZignL28vb2F1dGgyL2FwcHJvdmFsJykgPiAwXG4gICAgICAgICAgICAjIFRpdGxlIGlzOiBcIlN1Y2Nlc3MgY29kZT00L25XdWJsR2NjQXJqRFdNbjM3YTdVR1NDMlRGRzdwVVwiXG4gICAgICAgICAgICB0aXRsZSA9IG1haW5XaW5kb3cud2ViQ29udGVudHMuZ2V0VGl0bGUoKVxuICAgICAgICAgICAgIyBqdXN0IGdldCB0aGUgY29kZSBvdXQgb2YgdGhlIHRpdGxlXG4gICAgICAgICAgICBjb2RlID0gdGl0bGUuc3Vic3RyaW5nIDEzXG4gICAgICAgICAgICAjIGNsZWFuIHVwXG4gICAgICAgICAgICBtYWluV2luZG93LndlYkNvbnRlbnRzLnJlbW92ZUxpc3RlbmVyICdkaWQtZmluaXNoLWxvYWQnLCBvbkRpZEZpbmlzaExvYWRcbiAgICAgICAgICAgICMgYW5kIHJldHVybiBpdCB0byB0aGUgYXV0aFxuICAgICAgICAgICAgcnMgY29kZVxuXG4gICAgIyByZWRpcmVjdCB0byBnb29nbGUgb2F1dGhcbiAgICBtYWluV2luZG93LmxvYWRVcmwgQ2xpZW50Lk9BVVRIMl9MT0dJTl9VUkxcbiJdfQ==
